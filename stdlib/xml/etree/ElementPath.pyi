from collections.abc import Callable, Generator, Iterable
from re import Pattern
from typing import Any, Final, Literal, TypeVar, overload
from typing_extensions import TypeAlias
from xml.etree.ElementTree import Element, _Tag

xpath_tokenizer_re: Final[Pattern[str]]

_Token: TypeAlias = tuple[str, str]
_Next: TypeAlias = Callable[[], _Token]
_Callback: TypeAlias = Callable[[_SelectorContext, Iterable[Element[Any]]], Generator[Element[Any]]]
_T = TypeVar("_T")

def xpath_tokenizer(pattern: str, namespaces: dict[str, str] | None = None) -> Generator[_Token]: ...
def get_parent_map(context: _SelectorContext) -> dict[Element[Any], Element[Any]]: ...
def prepare_child(next: _Next, token: _Token) -> _Callback: ...
def prepare_star(next: _Next, token: _Token) -> _Callback: ...
def prepare_self(next: _Next, token: _Token) -> _Callback: ...
def prepare_descendant(next: _Next, token: _Token) -> _Callback | None: ...
def prepare_parent(next: _Next, token: _Token) -> _Callback: ...
def prepare_predicate(next: _Next, token: _Token) -> _Callback | None: ...

ops: Final[dict[str, Callable[[_Next, _Token], _Callback | None]]]

class _SelectorContext:
    parent_map: dict[Element[Any], Element[Any]] | None
    root: Element[Any]
    def __init__(self, root: Element[Any]) -> None: ...

@overload
def iterfind(  # type: ignore[overload-overlap]
    elem: Element[_Tag], path: Literal[""], namespaces: dict[str, str] | None = None
) -> None: ...
@overload
def iterfind(elem: Element[_Tag], path: str, namespaces: dict[str, str] | None = None) -> Generator[Element[_Tag]]: ...
def find(elem: Element[_Tag], path: str, namespaces: dict[str, str] | None = None) -> Element[_Tag] | None: ...
def findall(elem: Element[_Tag], path: str, namespaces: dict[str, str] | None = None) -> list[Element[_Tag]]: ...
@overload
def findtext(elem: Element[Any], path: str, default: None = None, namespaces: dict[str, str] | None = None) -> str | None: ...
@overload
def findtext(elem: Element[Any], path: str, default: _T, namespaces: dict[str, str] | None = None) -> _T | str: ...
